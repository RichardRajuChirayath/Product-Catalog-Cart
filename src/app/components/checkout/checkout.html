<div class="container checkout-wrapper">
    <div *ngIf="!orderSuccess(); else successView">
        <h1>Secure Checkout</h1>

        <mat-stepper linear #stepper class="checkout-stepper">
            <!-- Step 1: Customer Info -->
            <mat-step [stepControl]="customerInfo">
                <form [formGroup]="customerInfo">
                    <ng-template matStepLabel>Customer Details</ng-template>

                    <div class="step-content">
                        <mat-card class="stepper-card">
                            <mat-form-field appearance="outline" class="full-width">
                                <mat-label>Full Name</mat-label>
                                <input matInput formControlName="fullName" placeholder="John Doe">
                                <mat-error>Name is too short</mat-error>
                            </mat-form-field>

                            <div class="row">
                                <mat-form-field appearance="outline">
                                    <mat-label>Email Address</mat-label>
                                    <input matInput formControlName="email" type="email">
                                </mat-form-field>
                                <mat-form-field appearance="outline">
                                    <mat-label>Phone Number</mat-label>
                                    <input matInput formControlName="phone">
                                </mat-form-field>
                            </div>

                            <div class="stepper-actions">
                                <button mat-raised-button color="primary" matStepperNext>CONTINUE TO SHIPPING</button>
                            </div>
                        </mat-card>
                    </div>
                </form>
            </mat-step>

            <!-- Step 2: Shipping -->
            <mat-step [stepControl]="shippingInfo">
                <form [formGroup]="shippingInfo">
                    <ng-template matStepLabel>Shipping Address</ng-template>

                    <div class="step-content">
                        <mat-card class="stepper-card">
                            <mat-form-field appearance="outline" class="full-width">
                                <mat-label>Shipping Address</mat-label>
                                <textarea matInput formControlName="address" rows="3"></textarea>
                            </mat-form-field>

                            <div class="row">
                                <mat-form-field appearance="outline">
                                    <mat-label>City</mat-label>
                                    <input matInput formControlName="city">
                                </mat-form-field>
                                <mat-form-field appearance="outline">
                                    <mat-label>Zip Code</mat-label>
                                    <input matInput formControlName="zipCode">
                                </mat-form-field>
                            </div>

                            <div class="stepper-actions">
                                <button mat-button matStepperPrevious>BACK</button>
                                <button mat-raised-button color="primary" matStepperNext>REVIEW ORDER</button>
                            </div>
                        </mat-card>
                    </div>
                </form>
            </mat-step>

            <!-- Step 3: Review & Pay -->
            <mat-step>
                <ng-template matStepLabel>Review & Pay</ng-template>

                <div class="step-content">
                    <mat-card class="stepper-card">
                        <h3>Order Review</h3>
                        <div class="review-details">
                            <p><strong>Deliver to:</strong> {{ customerInfo.get('fullName')?.value }}</p>
                            <p><strong>Address:</strong> {{ shippingInfo.get('address')?.value }}, {{
                                shippingInfo.get('city')?.value }}</p>
                        </div>

                        <div class="summary-items">
                            <div class="summary-item" *ngFor="let item of cartService.cartItems()">
                                <span>{{ item.product.title }} (x{{ item.quantity }})</span>
                                <span>{{ (item.product.price * item.quantity) | currency:'INR':'symbol':'1.2-2'
                                    }}</span>
                            </div>
                        </div>

                        <div class="summary-total">
                            <span>Total Amount</span>
                            <span>{{ cartService.totalAmount() | currency:'INR':'symbol':'1.2-2' }}</span>
                        </div>

                        <div class="stepper-actions">
                            <button mat-button matStepperPrevious>BACK</button>
                            <button mat-raised-button color="primary" (click)="onSubmit()" class="place-order-btn"
                                [disabled]="cartService.totalItems() === 0">
                                PLACE ORDER (â‚¹{{ cartService.totalAmount() | number }})
                            </button>
                        </div>
                    </mat-card>
                </div>
            </mat-step>
        </mat-stepper>
    </div>

    <ng-template #successView>
        <div class="success-container">
            <div class="success-icon-box">
                <mat-icon>verified</mat-icon>
            </div>
            <h1>Order Confirmed!</h1>
            <p class="order-id">Order ID: {{ orderNumber() }}</p>
            <p>Thank you for your purchase. We've received your order and are preparing it for shipment.</p>

            <div class="tracking-timeline">
                <div class="timeline-step" [class.active]="trackingStep() >= 0">
                    <div class="step-icon"><mat-icon>assignment</mat-icon></div>
                    <div class="step-label">Order Placed</div>
                </div>
                <div class="timeline-connector" [class.active]="trackingStep() >= 1"></div>
                <div class="timeline-step" [class.active]="trackingStep() >= 1">
                    <div class="step-icon"><mat-icon>sync</mat-icon></div>
                    <div class="step-label">Processing</div>
                </div>
                <div class="timeline-connector" [class.active]="trackingStep() >= 2"></div>
                <div class="timeline-step" [class.active]="trackingStep() >= 2">
                    <div class="step-icon"><mat-icon>fact_check</mat-icon></div>
                    <div class="step-label">Quality Check</div>
                </div>
                <div class="timeline-connector" [class.active]="trackingStep() >= 3"></div>
                <div class="timeline-step" [class.active]="trackingStep() >= 3">
                    <div class="step-icon"><mat-icon>local_shipping</mat-icon></div>
                    <div class="step-label">Dispatched</div>
                </div>
            </div>

            <div class="success-actions">
                <button mat-raised-button color="primary" routerLink="/products">CONTINUE SHOPPING</button>
                <button mat-button routerLink="/products">VIEW MY ORDERS</button>
            </div>
        </div>
    </ng-template>
</div>